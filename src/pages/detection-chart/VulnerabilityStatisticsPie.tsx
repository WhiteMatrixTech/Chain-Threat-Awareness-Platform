/* eslint-disable @typescript-eslint/restrict-template-expressions */
/* eslint-disable prettier/prettier */
/*
 * @Description:
 * @Author: didadida262
 * @Date: 2024-08-26 10:34:32
 * @LastEditors: didadida262
 * @LastEditTime: 2024-10-17 14:58:14
 */
import { Pie, PieConfig } from "@ant-design/plots";
import cn from "classnames";
import { useSearchParams } from "react-router-dom";

import styles from "./DetectionChart.module.less";

const VulnerabilityStatisticsPie = () => {
  const [searchParams] = useSearchParams();
  let DetectionResults: any[] = [];
  try {
    DetectionResults = JSON.parse(
      window.atob(searchParams.get("result") || "") || ""
    );
  } catch (e) {}
  const pieConfig = ({
    data: [
      {
        type: "低危漏洞",
        value: DetectionResults.filter(o => o.security === "Low").length
      },
      {
        type: "中危漏洞",
        value: DetectionResults.filter(o => o.security === "Medium").length
      },
      {
        type: "高危漏洞",
        value: DetectionResults.filter(o => o.security === "High").length
      }
    ],
    height: 200,
    angleField: "value",
    colorField: "type",
    color: ["#6298F4", "#F9D95E", "#FE7979"],
    radius: 0.75,
    legend: true, // 关闭图例
    label: {
      type: "outer",
      // content: "{name}",
      content: function content(data: any) {
        return `${data.type} : ${(data.value /
          DetectionResults.length *
          100).toFixed(2)}%`;
      },
      style: {
        fill: "#303133"
      }
    },
    interactions: [
      {
        type: "element-selected"
      },
      {
        type: "element-active"
      }
    ]
  } as unknown) as PieConfig;
  return <Pie {...pieConfig} />;
};

export function VulnerabilityStatistics() {
  return (
    <div
      className={cn(
        styles.detectResultCard,
        "h-full flex-col bg-[#FFFAFA] py-[18px] px-6"
      )}
    >
      <div>
        <span className="text-xl font-medium">漏洞等级统计</span>
        <span className="pl-1 text-xl font-normal opacity-70" />
      </div>
      <div className="mt-5 h-[80%] w-full flex-1">
        <VulnerabilityStatisticsPie />
      </div>
    </div>
  );
}
